# Document Automation Module

This module provides a machine learning-based system for automatically filling O-1 visa application forms. It leverages transformer-based models to predict field values based on field names and form context.

## Components

The module consists of the following components:

1. **Data Loader (`data_loader.py`)**: Loads synthetic training data generated by previous pipeline stages.
2. **Template Processor (`template_processor.py`)**: Processes document templates and fills them with predicted or provided values.
3. **Model Architecture (`model_architecture.py`)**: Defines the neural network architecture for the document filling model.
4. **Training Pipeline (`training_pipeline.py`)**: Provides utilities for training the document filling model.
5. **Form Interface (`form_interface.py`)**: High-level interface for filling forms with the trained model.
6. **Evaluation (`evaluation.py`)**: Metrics and utilities for evaluating model performance.

## Usage

### Training a Document Filling Model

```python
from ml.document_automation import train_model

# Train with default parameters
model, tokenizer = train_model(
    data_dir="data/training/synthetic",
    model_dir="data/models",
    doc_types=["o1", "i129"],
    batch_size=32,
    epochs=50
)
```

### Filling Forms with a Trained Model

```python
from ml.document_automation import FormFillingInterface

# Initialize the interface
interface = FormFillingInterface(
    model_path="data/models/best_model.pt",
    vocab_path="data/models/vocab.json"
)

# List available templates
templates = interface.list_templates()
print(f"Available templates: {templates}")

# Fill a form with some provided values and predict the rest
field_values = {
    "family_name": "Smith",
    "given_name": "John",
    "date_of_birth": "1980-01-01"
}

filled_form_path = interface.fill_form(
    template_name="o1-form-template",
    field_values=field_values,
    autopredict=True
)

print(f"Filled form saved to: {filled_form_path}")
```

### Evaluating Model Performance

```python
from ml.document_automation import evaluate_model

# Evaluate with default parameters
results = evaluate_model(
    model_path="data/models/best_model.pt",
    vocab_path="data/models/vocab.json",
    test_data_dir="data/training/synthetic",
    results_dir="data/evaluation",
    doc_type="o1"
)
```

## Command-Line Interface

The module also provides a command-line interface for form filling:

```bash
# List available templates
python -m ml.document_automation.form_interface list

# List fields for a template
python -m ml.document_automation.form_interface fields o1-form-template

# Fill a form with values from a JSON file
python -m ml.document_automation.form_interface fill o1-form-template --json field_values.json --output filled_form.pdf
```

## Model Architecture

The document filling model uses a transformer-based architecture with the following components:

- Field embedding layer for embedding field names and values
- Field encoder for encoding field information
- Form context encoder for understanding relationships between fields
- Field value predictor for generating field values

The model is trained to predict both field values and field types (text, number, date, checkbox, etc.) based on field names and form context.

## Evaluation Metrics

The evaluation module calculates the following metrics:

- Exact match accuracy
- Character error rate
- BLEU score
- METEOR score
- Field type prediction accuracy

These metrics are reported both overall and per field type to identify strengths and weaknesses in the model.

## Directory Structure

```
ml/document_automation/
├── __init__.py              # Module initialization
├── data_loader.py           # Data loading utilities
├── template_processor.py    # Template processing utilities
├── model_architecture.py    # Model architecture definition
├── training_pipeline.py     # Training utilities
├── form_interface.py        # Form filling interface
├── evaluation.py            # Evaluation metrics and utilities
└── README.md                # This file
```

## Requirements

- PyTorch
- PyMuPDF
- NLTK
- scikit-learn
- NumPy
- pandas
- tqdm
- python-Levenshtein 